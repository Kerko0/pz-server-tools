#!/bin/bash

. "$(dirname "${0}")/pzenv"

USERS=($(jq -r -c '.pzservers[]' "${CONFIG}"))
if [ -z "${USERS}" ]; then
	echo No running pzserver found
	exit
fi

RESTARTS=($(jq -r -c '."daily-restarts"[]' "${CONFIG}"))
if [ -z "${RESTARTS}" ]; then
	echo No daily restarts configured
	exit
fi

NOW="$(date +%H:%M)"

for RESTART in ${RESTARTS[@]}; do

	if [ "${RESTART}" != "${NOW}" ]; then
		continue
	fi

	for USER in ${USERS[@]}; do
		sudo -u "${USER}" pzrestart
	done

done
