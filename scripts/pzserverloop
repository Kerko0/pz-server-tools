#!/bin/bash

. "$(dirname "${0}")/pzenv"

check_running

while true; do

	rm -f "${KILLSWITCH}" "${RESTARTSWITCH}"

	[[ -f "${PZSERVERLOG}" ]] && cp "${PZSERVERLOG}" "${PZSERVERLOG}.old"

	"${PZLAUNCHER}" &> "${PZSERVERLOG}"

	rm -f "${RESTARTSWITCH}"
	if [ -f "${KILLSWITCH}" ]; then
		echo Kill switch detected, quitting.
		rm -f "${KILLSWITCH}" "/tmp/pzserver.${USER}.restart"
		break
	fi

	echo Restarting.
done
