#!/bin/bash

# Ask for sudo password before printing anything to the console
sudo echo -n

REPO="$(dirname "$(dirname "${0}")")"
. "${REPO}/scripts/pzenv"

SRC="${REPO}/src"

echo You\'re about to uninstall Project Zomboid Server Tools
echo This will delete all related files and configuration

confirm_yes_no
if [ "${?}" = '0' ]; then
	echo Aborted
	exit
fi

echo [*] Removing system user: pzst

sudo userdel pzst 2> /dev/null || true

echo [*] Deleting virtual environment

sudo rm -rf "${ENV}"

echo [*] Uninstalling Project Zomboid Server Tools

sudo rm -f "${CRONFILE}"
sudo /etc/init.d/cron restart > /dev/null

for SCRIPT in $(ls -1 "${REPO}/scripts"); do
	sudo rm -f "${BIN}/${SCRIPT}"
done

sudo make -C "${SRC}" uninstall > /dev/null

sudo rm -f "${CACHE}" "${LOCK}" "${CONFIG}" "${CRONFILE}" "${LOGFILE}"

if [ -d "${CACHEDIR}" ]; then
	sudo rmdir "${CACHEDIR}"
fi

if [ -d "${CONFIGDIR}" ]; then
	sudo rmdir "${CONFIGDIR}"
fi

echo OK
